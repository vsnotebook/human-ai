<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>缅甸语同声传译</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- 引入字体图标 -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/recorder-js@1.0.7/dist/recorder.min.js"></script>
</head>
<!-- 修改 body 背景色 -->
<body class="bg-white min-h-screen">
    <div class="container mx-auto px-4 py-2 max-w-md">
        <!-- 顶部导航栏 -->
        <div class="flex justify-between items-center py-3 border-b">
            <h1 class="text-xl font-medium text-gray-800">翻译</h1>
            <button class="p-2">
                <i class="fas fa-user-circle text-xl text-gray-600"></i>
            </button>
        </div>

        <!-- 聊天内容区域 - 移除默认对话，修改背景色 -->
        <div class="bg-white p-4 mb-20" id="chatContainer">
            <div class="flex flex-col space-y-4">
                <!-- 移除默认对话示例 -->
            </div>
        </div>

        <!-- 底部控制区 - 优化样式 -->
        <div class="fixed bottom-0 left-0 right-0 bg-white border-t">
            <div class="flex justify-between items-center max-w-md mx-auto space-x-4 p-4">
                <button id="chineseBtn" class="flex-1 py-3 px-4 rounded-full bg-gray-50 text-gray-800 text-center active:bg-gray-100 hover:bg-gray-100 transition-colors duration-200">
                    按住说中文
                </button>
                <button id="myanmarBtn" class="flex-1 py-3 px-4 rounded-full bg-gray-50 text-gray-800 text-center active:bg-gray-100 hover:bg-gray-100 transition-colors duration-200">
                    ဗမာစကား
                </button>
            </div>
        </div>
    </div>

    <!-- 修改 addMessage 函数中的样式 -->
    <script>
        const chatContainer = document.getElementById('chatContainer');
        const chineseBtn = document.getElementById('chineseBtn');
        const myanmarBtn = document.getElementById('myanmarBtn');
        
        let mediaRecorder;
        let audioChunks = [];
        let isRecording = false;
        
        // 初始化录音功能
        async function initRecorder() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                mediaRecorder = new MediaRecorder(stream);
                
                mediaRecorder.ondataavailable = (event) => {
                    audioChunks.push(event.data);
                };
        
                mediaRecorder.onstop = async () => {
                    const audioBlob = new Blob(audioChunks, { type: 'audio/wav' });
                    // 这里可以将 audioBlob 发送到服务器进行语音识别和翻译
                    audioChunks = [];
                    
                    // 模拟翻译过程
                    showToast('正在翻译...');
                    setTimeout(() => {
                        if (currentLang === 'chinese') {
                            addMessage('你好，很高兴认识你。', 'မင်္ဂလာပါ၊ သင့်ကို တွေ့ရတာ ဝမ်းသာပါတယ်။', true);
                        } else {
                            addMessage('မင်္ဂလာပါ၊ ကျွန်တော် John ပါ။', '你好，我是约翰。', false);
                        }
                    }, 1000);
                };
            } catch (err) {
                console.error('无法访问麦克风:', err);
                showToast('无法访问麦克风');
            }
        }

        let currentLang = '';
        
        // 按住说话事件处理
        function handleTouchStart(btn, lang) {
            return async (e) => {
                e.preventDefault();
                if (!mediaRecorder) {
                    await initRecorder();
                }
                
                currentLang = lang;
                isRecording = true;
                audioChunks = [];
                
                if (mediaRecorder && mediaRecorder.state === 'inactive') {
                    mediaRecorder.start();
                    btn.classList.add('bg-blue-500', 'text-white');
                    btn.classList.remove('bg-gray-100', 'text-gray-800');
                    btn.textContent = lang === 'chinese' ? '松开结束' : 'လွှတ်ပါ';
                    showToast('正在录音...');
                }
            };
        }

        function handleTouchEnd(btn, defaultText) {
            return () => {
                if (isRecording && mediaRecorder) {
                    isRecording = false;
                    mediaRecorder.stop();
                    btn.classList.remove('bg-blue-500', 'text-white');
                    btn.classList.add('bg-gray-100', 'text-gray-800');
                    btn.textContent = defaultText;
                }
            };
        }

        // 绑定触摸事件和鼠标事件
        chineseBtn.addEventListener('touchstart', handleTouchStart(chineseBtn, 'chinese'));
        chineseBtn.addEventListener('touchend', handleTouchEnd(chineseBtn, '按住说中文'));
        chineseBtn.addEventListener('touchcancel', handleTouchEnd(chineseBtn, '按住说中文'));
        // 添加鼠标事件
        chineseBtn.addEventListener('mousedown', handleTouchStart(chineseBtn, 'chinese'));
        chineseBtn.addEventListener('mouseup', handleTouchEnd(chineseBtn, '按住说中文'));
        chineseBtn.addEventListener('mouseleave', handleTouchEnd(chineseBtn, '按住说中文'));

        myanmarBtn.addEventListener('touchstart', handleTouchStart(myanmarBtn, 'myanmar'));
        myanmarBtn.addEventListener('touchend', handleTouchEnd(myanmarBtn, 'ဗမာစကား'));
        myanmarBtn.addEventListener('touchcancel', handleTouchEnd(myanmarBtn, 'ဗမာစကား'));
        // 添加鼠标事件
        myanmarBtn.addEventListener('mousedown', handleTouchStart(myanmarBtn, 'myanmar'));
        myanmarBtn.addEventListener('mouseup', handleTouchEnd(myanmarBtn, 'ဗမာစကား'));
        myanmarBtn.addEventListener('mouseleave', handleTouchEnd(myanmarBtn, 'ဗမာစကား'));

        // 防止长按时触发系统菜单
        chineseBtn.addEventListener('contextmenu', (e) => e.preventDefault());
        myanmarBtn.addEventListener('contextmenu', (e) => e.preventDefault());

        // 添加新消息的函数
        function addMessage(text, translation, isChineseFirst = true) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `flex flex-col ${isChineseFirst ? 'items-start' : 'items-end'} mb-4`;
            
            messageDiv.innerHTML = `
                <div class="${isChineseFirst ? 'bg-gray-100' : 'bg-blue-500'} rounded-lg p-3 max-w-[80%] shadow-sm">
                    <p class="${isChineseFirst ? 'text-gray-800' : 'text-white'}">${text}</p>
                    <p class="${isChineseFirst ? 'text-gray-500' : 'text-blue-50'} text-sm mt-1">${translation}</p>
                </div>
            `;
            
            chatContainer.appendChild(messageDiv);
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }

        // 显示提示消息
        function showToast(message) {
            const toast = document.createElement('div');
            toast.className = 'fixed bottom-24 left-1/2 transform -translate-x-1/2 bg-gray-800 text-white px-4 py-2 rounded-lg opacity-0 transition-opacity duration-300';
            toast.textContent = message;
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.classList.remove('opacity-0');
                toast.classList.add('opacity-90');
            }, 100);
            
            setTimeout(() => {
                toast.classList.remove('opacity-90');
                toast.classList.add('opacity-0');
                setTimeout(() => {
                    document.body.removeChild(toast);
                }, 300);
            }, 2000);
        }
    </script>
</body>
</html>